@page "/availabilities"


<h3>Availabilities</h3>

@if (doctorsInCurrentUserLocation != null && doctorsInCurrentUserLocation.Any())
{
    <label for="doctorId">Doktorlarımız</label>
    <select class="form-control" @bind="selectedDoctorId">
        <option value="">Seçiniz</option>

        @foreach (var doctor in doctorsInCurrentUserLocation)
        {
            <option value="@doctor.Id">@($"{doctor.Name} {doctor.Surname}")</option>
        }

    </select>


    <button class="btn btn-primary btn-sm" @onclick="GetAvailabilitiesByDoctorId">Get Availabilities</button>
    <button class="btn btn-success btn-sm" @onclick="NavigateToCreateAvailability">Create Availability</button>
    <button class="btn btn-danger btn-sm" @onclick="DeleteAvailabilities">Delete Selected</button>
}
@if (isLoading)
{
    <p>Loading...</p>
}

else if (availabilities != null && availabilities.Any())
{
    <table class="table mt-4">
        <thead>
            <tr>
                <th><input type="checkbox" @bind="selectAll" @onclick="ToggleSelectAll" /></th>
                <th>Doktor</th>
                <th>Tarih</th>
                <th>Başlangıç Saati</th>
                <th>Bitiş Saati</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var availability in availabilities)
            {
                if (!availabilityCheckboxes.ContainsKey(availability.Id))
                {
                    availabilityCheckboxes[availability.Id] = false;
                }

                <tr>
                    <td><input type="checkbox" @bind="availabilityCheckboxes[availability.Id]" /></td>
                    <td>@($"{availability.Doctor.Name} {availability.Doctor.Surname}")</td>
                    <td>@availability.Date.ToShortDateString()</td>
                    <td>@availability.StartTime.ToString()</td>
                    <td>@availability.EndTime.ToString()</td>
                    <td>
                        <button class="btn btn-danger btn-sm" @onclick="() => DeleteAvailability(availability)">Delete</button>
                        <button class="btn btn-info btn-sm" @onclick="() => NavigateToEditAvailability(availability.Id)">Edit</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else if (availabilities != null && !availabilities.Any())
{
    <p>No Availability Found.</p>
}

@if (authenticationState!= null)
{
    @if (authenticationState.User?.Claims != null)
    {
        var registrationNumberClaim = authenticationState.User.Claims.FirstOrDefault(c => c.Type == "RegistrationNumber");
    }
}

